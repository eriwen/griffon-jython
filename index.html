<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Jython plugin for Griffon : Enables compiling and running Jython code on your Griffon application" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Jython plugin for Griffon</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/eriwen/griffon-jython">Fork Me on GitHub</a>

          <h1 id="project_title">Jython plugin for Griffon</h1>
          <h2 id="project_tagline">Enables compiling and running Jython code on your Griffon application</h2>

          <section id="downloads">
            <a class="zip_download_link" href="https://github.com/eriwen/griffon-jython/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/eriwen/griffon-jython/tarball/master">Download this project as a tar.gz file</a>
          </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>Installation</h2>

<p>The current version of the <em>Jython Plugin</em> is <em>0.3</em></p>

<p>To install just issue the following command within your <a href="http://griffon.codehaus.org/">Griffon</a> project:</p>

<pre><code>griffon install-plugin jython
</code></pre>

<h2>Usage</h2>

<p>You must place all Jython code under <code>$appdir/src/jython</code>, it will be compiled first before any sources available on <code>griffon-app</code> or <code>src/main</code> which means you can't reference any of those sources from your Jython code, while the Groovy sources can. You will be able to use the [LangBridge Plugin] facilities to communicate with other JVM languages.</p>

<p>Sources placed under <code>$appdir/src/jython</code> will generate Java classes available for use within griffon-app.</p>

<p><strong>$appdir/src/jython/griffon/JythonGreeter.py</strong></p>

<div class="highlight">
<pre><span class="kn">from</span> <span class="nn">org.codehaus.griffon</span> <span class="kn">import</span> <span class="n">IGreeter</span>

<span class="k">class</span> <span class="nc">JythonGreeter</span><span class="p">(</span><span class="n">IGreeter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">who</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">greeting</span> <span class="o">=</span> <span class="s">'Hello </span><span class="si">%s</span><span class="s"> from Jython!'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">who</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">greeting</span>
        <span class="n">model</span><span class="o">.</span><span class="n">setOutput</span><span class="p">(</span><span class="n">greeting</span><span class="p">)</span>
</pre>
</div>


<p>This will generate a Java class named <code>griffon.JythonGreeter</code>, which can be used inside any Griffon artifact, for example a Controller</p>

<div class="highlight">
<pre><span class="kn">import</span> <span class="nn">javax.swing.JOptionPane</span>
<span class="kn">import</span> <span class="nn">java.beans.PropertyChangeListener</span>
<span class="kn">import</span> <span class="nn">org.codehaus.griffon.IGreeter</span>
<span class="kn">import</span> <span class="nn">griffon.jython.JythonObjectFactory</span>

<span class="kd">class</span> <span class="nc">JyAppController</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">model</span>
    <span class="kt">def</span> <span class="n">view</span>
    <span class="kt">def</span> <span class="n">greeter</span>

    <span class="kt">def</span> <span class="nf">mvcGroupInit</span><span class="o">(</span><span class="n">Map</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">model</span><span class="o">.</span><span class="na">addPropertyChangeListener</span><span class="o">(</span><span class="s2">"output"</span><span class="o">,</span> <span class="o">{</span> <span class="n">evt</span> <span class="o">-&gt;</span>
             <span class="k">if</span><span class="o">(!</span><span class="n">evt</span><span class="o">.</span><span class="na">newValue</span><span class="o">)</span> <span class="k">return</span>
             <span class="c1">// model.output may have been updated outside EDT</span>
             <span class="n">doLater</span> <span class="o">{</span>
                 <span class="n">JOptionPane</span><span class="o">.</span><span class="na">showMessageDialog</span><span class="o">(</span><span class="n">app</span><span class="o">.</span><span class="na">windowManager</span><span class="o">.</span><span class="na">windows</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span>
                     <span class="n">evt</span><span class="o">.</span><span class="na">newValue</span><span class="o">,</span> <span class="s2">"Yay for Jython"</span><span class="o">,</span> <span class="n">JOptionPane</span><span class="o">.</span><span class="na">INFORMATION_MESSAGE</span><span class="o">)</span>
             <span class="o">}</span>
         <span class="o">}</span> <span class="k">as</span> <span class="n">PropertyChangeListener</span><span class="o">)</span>

         <span class="c1">// Create our JythonGreeter</span>
         <span class="n">JythonObjectFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JythonObjectFactory</span><span class="o">(</span><span class="n">IGreeter</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s1">'JythonGreeter'</span><span class="o">,</span> <span class="s1">'JythonGreeter'</span><span class="o">)</span>
         <span class="n">greeter</span> <span class="o">=</span> <span class="o">(</span><span class="n">IGreeter</span><span class="o">)</span> <span class="n">factory</span><span class="o">.</span><span class="na">createObject</span><span class="o">()</span>
     <span class="o">}</span>

    <span class="kt">def</span> <span class="n">handleClick</span> <span class="o">=</span> <span class="o">{</span> <span class="n">evt</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">-&gt;</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">model</span><span class="o">.</span><span class="na">input</span><span class="o">)</span> <span class="k">return</span>
        <span class="c1">// clear the result first</span>
        <span class="n">model</span><span class="o">.</span><span class="na">output</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="c1">// invoke Jython class outside the EDT</span>
        <span class="n">doOutside</span> <span class="o">{</span>
            <span class="n">greeter</span><span class="o">.</span><span class="na">greet</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">input</span><span class="o">,</span> <span class="n">model</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>
</div>


<p>You are also able to load Jython scripts at any time. By default all scripts placed at <code>$basedir/griffon-app/resources/jython</code> will be loaded when the application boostraps itself. For example <code>griffon-app/resources/jython/fib.py</code> might look like this:</p>

<div class="highlight">
<pre><span class="k">def</span> <span class="nf">addNumbers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre>
</div>


<p>With that code in place, the addNumbers function may be executed as a method call on a dynamic property named <code>py</code> from a Griffon controller. See below:</p>

<div class="highlight">
<pre><span class="kd">class</span> <span class="nc">FooController</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">addNumbers</span> <span class="o">=</span> <span class="o">{</span> <span class="n">evt</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">-&gt;</span>
       <span class="c1">// invoke the function as a method on the 'py' dynamic property</span>
       <span class="n">model</span><span class="o">.</span><span class="na">z</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="na">add_numbers</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">model</span><span class="o">.</span><span class="na">y</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>
</div>


<p>The dynamic property will be named <code>py</code> by default. The name of the property may be set explicitly in <code>griffon-app/conf/Config.groovy</code> by assigning a value to the griffon.jython.dynamicPropertyName property.</p>

<pre><code>griffon.jython.dynamicPropertyName = 'jythonPropertyName'
</code></pre>

<p>For most applications, the default name of <code>py</code> should be fine. You can also alter in which artifacts the property gets injected, by default only controllers will have that property. See <code>griffon-app/conf/Config.groovy</code> and look for the following entry</p>

<pre><code>griffon.jython.injectInto = ["controller"]
</code></pre>

<p>Finally, you can load any Jython script by calling <code>pyLoad(String path)</code> where <code>path</code> will be resolved using Spring's PathMatchingResourcePatternResolver. The default path used during bootstrap is <code>"classpath*:/jython/\*</code><code>{}*/*{</code>}<code>.py"</code>. It is also worth mentioning that this method will be injected to all artifacts controlled by <code>griffon.jython.injectInto</code> and that the prefix <code>py</code> will be affected by <code>griffon.jython.dynamicPropertyName</code>.</p>

<h3>Scripts</h3>

<ul>
<li>
<em>create-jython-class</em> - creates a new Jython class in <code>$basedir/src/jython</code>.</li>
<li>
<em>create-jython-script</em> - creates a new Jython script in <code>$basedir/griffon-app/resources/py</code>.</li>
<li>
<em>jython-repl</em> - executes a Jython REPL with the application's classpath fully configured.</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Jython plugin for Griffon maintained by <a href="https://github.com/eriwen">eriwen</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
